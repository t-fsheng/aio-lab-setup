# AIO-16 LAB SETUP

## Overview


| **EX16_AIO** |     |     |
| --- | --- | --- |
| Host | shgbsvmas | [VMAS - Workspaces](https://shgbsvmas/#/Workspaces) |
| Host Name | AIO-16 |     |
| Role | DC & MBX & Outlook |     |
| OS Version | Windows Server 2016 Datacenter (RTM)|     |
| Original OS Language | English (en-us) |     |
| Additional Language Packs | Simplified Chinese (zh-cn)<br>Traditional Chinese (zh-tw) |     |
| Exchange Build Number | CU23 | Exchange Server build numbers and release dates<br>[https://docs.microsoft.com/en-us/exchange/new-features/build-numbers-and-release-dates?view=exchserver-2019](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fdocs.microsoft.com%2Fen-us%2Fexchange%2Fnew-features%2Fbuild-numbers-and-release-dates%3Fview%3Dexchserver-2019&data=05%7C01%7Ct-fsheng%40microsoft.com%7C782fa10a65eb4f329d1508da8bfb2e12%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637976208194977653%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=KP6Ut9En9lE7r7O5K4WpgyqFWTr%2BTZlC7kEsCGCW3E8%3D&reserved=0) |
| Password Complexity | 16   |     |
| Certificate created and configured | Exchange self-generated |     |
| Outlook Version | Microsoft 365 2019 |     |
| Outlook Language Packs | Simplified Chinese (zh-cn)<br>English (en-us)<br>Traditional Chinese (zh-tw) |     |
| Outlook Anywhere enabled | Y   |     |
| OAB and EWS enabled | Y   |     |
| Network Monitor installed | Y   | [https://aka.ms/wxex](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2Fwxex&data=05%7C01%7Ct-fsheng%40microsoft.com%7C782fa10a65eb4f329d1508da8bfb2e12%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637976208194977653%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=6xq9Wi9gsCpPsToD6KFsM9Qhjp0bd5seqOoE4UmKbzg%3D&reserved=0) |
| Fiddler installed | Y   | [https://aka.ms/wxex](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2Fwxex&data=05%7C01%7Ct-fsheng%40microsoft.com%7C782fa10a65eb4f329d1508da8bfb2e12%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637976208194977653%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=6xq9Wi9gsCpPsToD6KFsM9Qhjp0bd5seqOoE4UmKbzg%3D&reserved=0) |
| Telnet25 | Y   | [https://aka.ms/wxex](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2Fwxex&data=05%7C01%7Ct-fsheng%40microsoft.com%7C782fa10a65eb4f329d1508da8bfb2e12%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637976208194977653%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=6xq9Wi9gsCpPsToD6KFsM9Qhjp0bd5seqOoE4UmKbzg%3D&reserved=0) |
| ExTRA | Y   | [https://aka.ms/wxex](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Faka.ms%2Fwxex&data=05%7C01%7Ct-fsheng%40microsoft.com%7C782fa10a65eb4f329d1508da8bfb2e12%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637976208194977653%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=6xq9Wi9gsCpPsToD6KFsM9Qhjp0bd5seqOoE4UmKbzg%3D&reserved=0) |
| Disable CRL check |     | Exchange 2010 Management Console (EMC) is very slow<br>[https://blogs.technet.microsoft.com/nawar/2011/06/03/exchange-2010-management-console-emc-is-very-slow/](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Fblogs.technet.microsoft.com%2Fnawar%2F2011%2F06%2F03%2Fexchange-2010-management-console-emc-is-very-slow%2F&data=05%7C01%7Ct-fsheng%40microsoft.com%7C782fa10a65eb4f329d1508da8bfb2e12%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637976208194977653%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=Hoo%2BgXCBkwvIWsFNDVQY9bxiem7vrN7qi8xtOVm8nvo%3D&reserved=0)<br>Configuring Exchange Servers Without Internet Access<br>[https://techcommunity.microsoft.com/t5/exchange-team-blog/configuring-exchange-servers-without-internet-access/ba-p/593692](https://nam06.safelinks.protection.outlook.com/?url=https%3A%2F%2Ftechcommunity.microsoft.com%2Ft5%2Fexchange-team-blog%2Fconfiguring-exchange-servers-without-internet-access%2Fba-p%2F593692&data=05%7C01%7Ct-fsheng%40microsoft.com%7C782fa10a65eb4f329d1508da8bfb2e12%7C72f988bf86f141af91ab2d7cd011db47%7C1%7C0%7C637976208194977653%7CUnknown%7CTWFpbGZsb3d8eyJWIjoiMC4wLjAwMDAiLCJQIjoiV2luMzIiLCJBTiI6Ik1haWwiLCJXVCI6Mn0%3D%7C3000%7C%7C%7C&sdata=%2BD6NVy2WMbhC%2FmJJ6Un5dwzDGw2gu1nEQ%2BnqjMLeXwY%3D&reserved=0) |
| NIC | Private IP |     |
| ActiveSync device connectivity | Y   |     |
| Additional disk for Backup issue | Y   |     |
| Enable Windows Server Backup | Y   |     |
| Backup | Y   |     |
| Snap Shot | Y   |     |
| Lab known issue |     | If EMC and EMS does not work properly, please clean the credential manager in the Control Panel. It is because Outlook user credential cache. |
| FAQ |     |     |

* * *


## Deployment Step by step
========================

Here are the deferences of deployment between the AIO-16 and the general AIO. For more information about the general deployment of AIO, see [General Deployment of AIO Step by step](General%20Deployment%20of%20AIO%20Step%20by%20step.md).

### Step 1: configure the all-in-one virtual machine on VMAs.
>1.3. In the pop up **New Workspace**, type "2016" in the Filter Operating Systems, add one **Windows 2016 Datacenter (RTM)**, and click on 'Next' at the 'Step 1' tab.
>![aio-1.3.png](https://s2.loli.net/2022/09/16/3Mq1nr8PNEh7j4R.png)

### Step 2: login the AIO.
>
>2.3.  Double-click on the **AIO-16:NIC1(RDP)** and login.
>![aio-2.3.png](https://s2.loli.net/2022/09/16/8sM9JgRhKVTadvC.png)

### Step 3: install necessary applications needed for AIO-16.
You need to install apps below: 
1. Microsoft Edge Browser.
2. .NET Framework 4.8.
3. Visual C++ Redistributable Package for Visual Studio 2013
4. Unified Communications Managed API 4.0 Runtime
5. IIS URL Rewrite 2.1
6. ISO: Cumulative Update 23 for Exchange Server 2016

The installation of 1~4 refer to 'Step 3' of [General Deployment of AIO Step by step](General%20Deployment%20of%20AIO%20Step%20by%20step.md)ï¼›
<br>
The installation of 5~6 refer to 'Step 3' in this article;
<br>
>3.1 Install [IIS URL Rewrite 2.1](https://www.iis.net/downloads/microsoft/url-rewrite).
>
>>3.1.1 After entering the hyperlink above, click on **install this extension** button and download.
>>![3.1.1.png](https://s2.loli.net/2022/09/16/NrLEoBPpxhymXT3.png)
>> 
>> 3.1.2 Double-click on the exe and the **Web platform installer 5.1** will pop up. Click on **install** button.
>>![3.1.2.png](https://s2.loli.net/2022/09/16/vPxd3aFNYbjwkLr.png)
>>
>>3.1.3 In the pop-up, click on the "I accept..." button.
>>![3.1.3.png](https://s2.loli.net/2022/09/16/dDMOCuISfxZkzRc.png)
>>
>>3.1.4 The installation of **IIS URL Rewrite 2.1** is completed and exit the installer.
>>![3.1.4.png](https://s2.loli.net/2022/09/16/3IZWSVnaX6K2lpD.png)
>
>3.2 Download [Cumulative Update 23 for Exchange Server 2016 (KB5011155)](https://www.microsoft.com/en-us/download/details.aspx?id=104132). Click on the link and the 'Download' button on this page.
>![3.2.1.png](https://s2.loli.net/2022/09/16/BMVhfoKRFHNTm9D.png)

### Step 4: pending the ISO.
Refer to 'Step 4' of [General Deployment of AIO Step by step](General%20Deployment%20of%20AIO%20Step%20by%20step.md).

> Double-click on the **ExchangeServer2016-x64-CU23** and let the ISO stay pending.
>![3.2.2.png](https://s2.loli.net/2022/09/16/eNnYBlU2a7xVvIq.png)
>
>![3.2.3.png](https://s2.loli.net/2022/09/16/RgDfIVM7QNHL1pE.png)

### Step 5: install Windows Features.
>
>5.1.  Run powershell as admin.
>![6.1.png](https://s2.loli.net/2022/09/16/tYjgxCMDzXqfVGP.png)
>
>5.2.  Run the following cmdlet in powershell.
>```
>Install-WindowsFeature Server-Media-Foundation, NET-Framework-45-Features, RPC-over-HTTP-proxy, RSAT-Clustering, RSAT-Clustering-CmdInterface, RSAT-Clustering-Mgmt, RSAT-Clustering-PowerShell, Web-Mgmt-Console, WAS-Process-Model, Web-Asp-Net45, Web-Basic-Auth, Web-Client-Auth, Web-Digest-Auth, Web-Dir-Browsing, Web-Dyn-Compression, Web-Http-Errors, Web-Http-Logging, Web-Http-Redirect, Web-Http-Tracing, Web-ISAPI-Ext, Web-ISAPI-Filter, Web-Lgcy-Mgmt-Console, Web-Metabase, Web-Mgmt-Console, Web-Mgmt-Service, Web-Net-Ext45, Web-Request-Monitor, Web-Server, Web-Stat-Compression, Web-Static-Content, Web-Windows-Auth, Web-WMI, Windows-Identity-Foundation, RSAT-ADDS
>```
>![6.2.1.png](https://s2.loli.net/2022/09/16/AWrH6oJzS17ytsk.png)
>
>![6.2.2.png](https://s2.loli.net/2022/09/16/bzWkv4H7lMprTnC.png)
>

### Step 6: use cmdlet to prepare AD schema, AD, and AD domain.
**Reference**:
* [Prepare Active Directory and domains for Exchange Server, Active Directory Exchange Server, Exchange Server Active Directory, Exchange 2019 Active Directory | Microsoft Docs](https://docs.microsoft.com/en-us/exchange/plan-and-deploy/prepare-ad-and-domains?view=exchserver-2019)

>6.1 Make sure that the ISO pending.
>![3.2.3.png](https://s2.loli.net/2022/09/16/RgDfIVM7QNHL1pE.png)
>
>6.2 Search for **cmd**, right-click on command prompt and run as admin.
>![5.2.png](https://s2.loli.net/2022/09/16/VEsNF5mAzvn8iQG.png)
>
>6.3. Type the below cmdlet as following.
>
>>6.3.1 Prepare schema.
>>```
>>E:\\Setup.exe /IAcceptExchangeServerLicenseTerms_DiagnosticDataON /PrepareSchema
>>```
>>![5.3.1.png](https://s2.loli.net/2022/09/16/TClQKJhgRauVcOz.png)
>>
>>6.3.2 Prepare AD.
>>```
>>E:\\Setup.exe /IAcceptExchangeServerLicenseTerms_DiagnosticDataON /PrepareAD /OrganizationName:"TestOrg"
>>```
>>![5.3.2.png](https://s2.loli.net/2022/09/16/Q5jDdvVPONmCpK1.png)
>>
>>6.3.3 Prepare domains.
>>```
>>E:\\Setup.exe /IAcceptExchangeServerLicenseTerms_DiagnosticDataON /PrepareAllDomains
>>```
>>Or
>>```
>>E:\\Setup.exe /IAcceptExchangeServerLicenseTerms_DiagnosticDataON /PrepareDomain:\<domain name>
>>```
>>![5.3.3.png](https://s2.loli.net/2022/09/16/bxXdla5SqIjLP2t.png)
>>
>Then the preparation of AD and domains for Exchange Server has been completed.



### Step 7: install exchange mailbox role
>
>7.1.  Run cmd as admin.
>
>7.2.  Run the following command:
>```
>E:\\Setup.exe /IAcceptExchangeServerLicenseTerms_DiagnosticDataON /mode:Install /role:Mailbox /DomainController:<DC name\>
>```
>![7.2.png](https://s2.loli.net/2022/09/16/pf64kwhYRQSWa1X.png)
>
>>* Problem: You will receive the warning: 
>>```
>>Installing Exchange Server on a domain controller will elevate the permissions for Exchange Trusted Subsystem to domain administrators.
>>```
>>* Solution:
>>1.  Go to **Server Manager --> Tools --> \<domain> --> Builtin --> Administrators --> Properties --> Members**.
>>![s1.png](https://s2.loli.net/2022/09/16/kpoX5OjW1x3SmUE.png)
>>
>>2.  Click on **Add** button.
>>![s2.png](https://s2.loli.net/2022/09/16/4gtsojf1ZXRd7uv.png)
>>
>>3.  Type "Exchange Trusted Subsystem" in the box and click on **Check Names** button, then click on **OK**.
>>![s3.png](https://s2.loli.net/2022/09/16/KztdhPamNsuHCLv.png)
>>
>7.3 Wait for the installation.
>![7.3.png](https://s2.loli.net/2022/09/16/ladRU6eExFW72SI.png)
>
>7.4 Then reboot your system.
>

### Step 8: install o365.

Same as **Step 7** in [General Deployment of AIO Step by step](General%20Deployment%20of%20AIO%20Step%20by%20step.md).

### Preparation mentioned in Overview.
Same as **Preparation mentioned in Overview** in [General Deployment of AIO Step by step](General%20Deployment%20of%20AIO%20Step%20by%20step.md).


